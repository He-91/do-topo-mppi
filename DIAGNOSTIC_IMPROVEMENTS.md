# åŠ¨æ€éšœç¢ç‰©é¿è®©ç³»ç»Ÿè¯Šæ–­ä¸æ”¹è¿›æŠ¥å‘Š

## ğŸ“‹ æµ‹è¯•ç»“æœåˆ†ææ€»ç»“

### âœ… å·²ç¡®è®¤å·¥ä½œçš„åŠŸèƒ½

åŸºäº `test.txt` ä¸­çš„2319è¡Œæ—¥å¿—ï¼Œä»¥ä¸‹æ¨¡å—è¿è¡Œæ­£å¸¸ï¼š

1. **æ‹“æ‰‘è§„åˆ’ï¼ˆTopoPRMï¼‰**
   - âœ… æˆåŠŸç”Ÿæˆ1-12æ¡å¼‚æ„æ‹“æ‰‘è·¯å¾„
   - âœ… éšœç¢ç‰©åˆ‡çº¿ç”Ÿæˆç®—æ³•æ­£å¸¸ï¼ˆaccepted=0-12ä¸ªåˆ‡çº¿ï¼‰
   - âœ… DFSæœç´¢æ‰¾åˆ°13æ¡è¿é€šè·¯å¾„
   - âœ… è·¯å¾„å»é‡å’Œç­›é€‰å·¥ä½œæ­£å¸¸

2. **MPPIè½¨è¿¹ä¼˜åŒ–**
   - âœ… å•è·¯å¾„å’Œå¤šè·¯å¾„ä¼˜åŒ–æ¨¡å¼å‡æ­£å¸¸
   - âœ… æˆæœ¬è®¡ç®—åˆç†ï¼šåŸå§‹æˆæœ¬466-914ï¼Œå½’ä¸€åŒ–æˆæœ¬65-155
   - âœ… è·¯å¾„é•¿åº¦èŒƒå›´ï¼š5.21m - 8.52m
   - âœ… ä½¿ç”¨500è‡ªé€‚åº”æ ·æœ¬æ•°ï¼Œæ”¶æ•›è‰¯å¥½

3. **Bæ ·æ¡å¹³æ»‘**
   - âœ… ä¼˜åŒ–è¿­ä»£æ¬¡æ•°ï¼š26-52æ¬¡
   - âœ… ä¼˜åŒ–æ—¶é—´æå¿«ï¼š0.036-0.085ms
   - âœ… æ‰€æœ‰å¹³æ»‘æ“ä½œè¿”å› SUCCESS

4. **FSMçŠ¶æ€æœº**
   - âœ… çŠ¶æ€è½¬æ¢æ­£å¸¸ï¼šWAIT_TARGET â†’ EXEC_TRAJ â†’ REPLAN_TRAJ
   - âœ… é‡è§„åˆ’è§¦å‘åˆç†ï¼ˆæµ‹è¯•ä¸­è§¦å‘äº†#57-#69æ¬¡é‡è§„åˆ’ï¼‰
   - âœ… ç›®æ ‡æˆåŠŸåˆ°è¾¾

---

### âš ï¸ **å…³é”®é—®é¢˜ï¼šåŠ¨æ€éšœç¢ç‰©é¢„æµ‹ç³»ç»ŸçŠ¶æ€æœªçŸ¥**

**é—®é¢˜æè¿°ï¼š**
ä»2319è¡Œæ—¥å¿—ä¸­ï¼Œ**å®Œå…¨æ²¡æœ‰æ‰¾åˆ°åŠ¨æ€éšœç¢ç‰©é¢„æµ‹ç³»ç»Ÿçš„ä»»ä½•è¯æ®**ï¼š

1. âŒ æ—  `/dynamic_obstacles/predicted_paths` è¯é¢˜æ´»åŠ¨ä¿¡æ¯
2. âŒ æ—  `grid_map::dynamicPredictionCallback()` è¢«è°ƒç”¨çš„è¿¹è±¡
3. âŒ æ—  `getDynamicDistance()` è¿”å›å®é™…éšœç¢ç‰©è·ç¦»çš„è¯æ®
4. âŒ æ— æ³•ç¡®è®¤ bspline_optimizer çš„åŠ¨æ€æˆæœ¬è®¡ç®—æ˜¯å¦ç”Ÿæ•ˆ

**å¯èƒ½åŸå› åˆ†æï¼š**

#### åœºæ™¯1ï¼šç³»ç»Ÿæ­£å¸¸ä½†æ— å½±å“ï¼ˆæœ€å¯èƒ½ï¼‰
- åŠ¨æ€é¢„æµ‹ç¡®å®åœ¨è¿è¡Œï¼Œä½†éšœç¢ç‰©ç¦»è½¨è¿¹å¤ªè¿œ
- `getDynamicDistance()` è¿”å›çš„è·ç¦»å§‹ç»ˆ > `3.0 * clearance`ï¼ˆçº¦1.5ç±³ï¼‰
- åŠ¨æ€æˆæœ¬å§‹ç»ˆä¸º0ï¼Œä¸å½±å“ä¼˜åŒ–è¿‡ç¨‹
- **ç°è±¡ï¼š**è§„åˆ’ç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼Œä½†åŠ¨æ€é¿éšœåŠŸèƒ½"éšèº«"

#### åœºæ™¯2ï¼šè¯é¢˜é€šä¿¡é—®é¢˜
- `dynamic_obstacle_generator` èŠ‚ç‚¹å¯èƒ½æœªå¯åŠ¨
- è¯é¢˜åç§°å¯èƒ½ä¸åŒ¹é…
- `grid_map` çš„è®¢é˜…å¯èƒ½æœªæˆåŠŸå»ºç«‹
- **éªŒè¯æ–¹æ³•ï¼š**`rostopic list`, `rostopic info`

#### åœºæ™¯3ï¼šæ•°æ®æœ‰æ•ˆæœŸé—®é¢˜
- é¢„æµ‹æ•°æ®çš„ `last_prediction_time_` ä¸€ç›´è¿‡æœŸï¼ˆ> 0.5ç§’ï¼‰
- `getDynamicDistance()` æ€»æ˜¯æå‰è¿”å›é»˜è®¤å€¼ 10000.0
- **éªŒè¯æ–¹æ³•ï¼š**æ·»åŠ æ—¥å¿—æ£€æŸ¥æ—¶é—´æˆ³

---

## ğŸ”§ å·²å®æ–½çš„æ”¹è¿›æªæ–½

### æ”¹è¿›1ï¼šæ·»åŠ ç½‘æ ¼åœ°å›¾ï¼ˆGridMapï¼‰è¯Šæ–­æ—¥å¿—

**ä¿®æ”¹æ–‡ä»¶ï¼š** `planner/plan_env/src/grid_map.cpp`

#### 1.1 é¢„æµ‹æ¥æ”¶æ—¥å¿—
```cpp
void GridMap::dynamicPredictionCallback(...) {
  // ...
  // æ·»åŠ è¯Šæ–­æ—¥å¿—
  if (valid_predictions > 0) {
    ROS_INFO_THROTTLE(2.0, "[GridMap] ğŸ“¡ Received %d dynamic obstacle predictions", valid_predictions);
  }
}
```
- **è§¦å‘æ¡ä»¶ï¼š**æ¯æ¬¡æ”¶åˆ°MarkerArrayæ¶ˆæ¯ä¸”åŒ…å«æœ‰æ•ˆé¢„æµ‹
- **è¾“å‡ºé¢‘ç‡ï¼š**æœ€å¤šæ¯2ç§’è¾“å‡ºä¸€æ¬¡
- **ä½œç”¨ï¼š**ç¡®è®¤ `dynamicPredictionCallback()` è¢«è°ƒç”¨ä¸”æˆåŠŸè§£ææ•°æ®

#### 1.2 é¢„æµ‹ç¼ºå¤±è­¦å‘Š
```cpp
double GridMap::getDynamicDistance(...) {
  if (md_.dynamic_predictions_.empty()) {
    ROS_WARN_THROTTLE(5.0, "[GridMap] âš ï¸  No dynamic predictions available");
    return 10000.0;
  }
  // ...
}
```
- **è§¦å‘æ¡ä»¶ï¼š**ä¼˜åŒ–å™¨æŸ¥è¯¢åŠ¨æ€è·ç¦»ä½†é¢„æµ‹æ•°æ®ä¸ºç©º
- **è¾“å‡ºé¢‘ç‡ï¼š**æœ€å¤šæ¯5ç§’è¾“å‡ºä¸€æ¬¡
- **ä½œç”¨ï¼š**è¯Šæ–­è¯é¢˜æ˜¯å¦æ­£å¸¸å‘å¸ƒå’Œè®¢é˜…

#### 1.3 é¢„æµ‹è¿‡æœŸè­¦å‘Š
```cpp
double GridMap::getDynamicDistance(...) {
  // ...
  double time_since_update = (ros::Time::now() - md_.last_prediction_time_).toSec();
  if (time_since_update > 0.5) {
    ROS_WARN_THROTTLE(5.0, "[GridMap] âš ï¸  Predictions expired (%.2fs old)", time_since_update);
    return 10000.0;
  }
  // ...
}
```
- **è§¦å‘æ¡ä»¶ï¼š**é¢„æµ‹æ•°æ®è¶…è¿‡0.5ç§’æœªæ›´æ–°
- **è¾“å‡ºé¢‘ç‡ï¼š**æœ€å¤šæ¯5ç§’è¾“å‡ºä¸€æ¬¡
- **ä½œç”¨ï¼š**è¯Šæ–­ `dynamic_obstacle_generator` æ˜¯å¦æ­£å¸¸å‘å¸ƒ

#### 1.4 è¿‘è·ç¦»éšœç¢ç‰©æ£€æµ‹æ—¥å¿—
```cpp
double GridMap::getDynamicDistance(...) {
  // ...
  // æ·»åŠ è¯Šæ–­æ—¥å¿—ï¼šå½“æ£€æµ‹åˆ°è¿‘è·ç¦»åŠ¨æ€éšœç¢ç‰©æ—¶è¾“å‡º
  if (min_distance < 5.0) {  // 5ç±³èŒƒå›´å†…çš„éšœç¢ç‰©
    ROS_INFO_THROTTLE(1.0, "[GridMap] ğŸ¯ Dynamic obstacle detected: dist=%.2fm at t=%.2fs", 
                      min_distance, time_from_now);
  }
  
  return min_distance;
}
```
- **è§¦å‘æ¡ä»¶ï¼š**æ£€æµ‹åˆ°5ç±³èŒƒå›´å†…çš„åŠ¨æ€éšœç¢ç‰©
- **è¾“å‡ºé¢‘ç‡ï¼š**æœ€å¤šæ¯1ç§’è¾“å‡ºä¸€æ¬¡
- **ä½œç”¨ï¼š**ç¡®è®¤åŠ¨æ€è·ç¦»è®¡ç®—æ­£ç¡®ä¸”æœ‰å®é™…éšœç¢ç‰©

---

### æ”¹è¿›2ï¼šæ·»åŠ Bæ ·æ¡ä¼˜åŒ–å™¨ï¼ˆBsplineOptimizerï¼‰è¯Šæ–­æ—¥å¿—

**ä¿®æ”¹æ–‡ä»¶ï¼š** `planner/bspline_opt/src/bspline_optimizer.cpp`

#### 2.1 åŠ¨æ€æˆæœ¬ç»Ÿè®¡
```cpp
void BsplineOptimizer::calcDistanceCostRebound(...) {
  // ...
  int dynamic_cost_count = 0;
  double total_dynamic_cost = 0.0;
  
  for (auto i = order_; i < end_idx; ++i) {
    // ...
    if (dynamic_dist > 0.0 && dynamic_dist < 3.0 * cps_.clearance) {
      // ...
      dynamic_cost_count++;
      total_dynamic_cost += point_cost;
    }
  }
  
  // æ·»åŠ è¯Šæ–­æ—¥å¿—ï¼šå½“åŠ¨æ€éšœç¢ç‰©å½±å“ä¼˜åŒ–æ—¶è¾“å‡º
  if (dynamic_cost_count > 0) {
    ROS_INFO_THROTTLE(1.0, "[BsplineOpt] ğŸš¨ Dynamic obstacles affecting %d control points, total cost=%.3f", 
                      dynamic_cost_count, total_dynamic_cost);
  }
}
```
- **è§¦å‘æ¡ä»¶ï¼š**åŠ¨æ€éšœç¢ç‰©å½±å“è‡³å°‘1ä¸ªæ§åˆ¶ç‚¹çš„æˆæœ¬è®¡ç®—
- **è¾“å‡ºé¢‘ç‡ï¼š**æœ€å¤šæ¯1ç§’è¾“å‡ºä¸€æ¬¡
- **ä½œç”¨ï¼š**
  - ç¡®è®¤åŠ¨æ€æˆæœ¬è®¡ç®—è¢«æ‰§è¡Œ
  - æ˜¾ç¤ºæœ‰å¤šå°‘ä¸ªæ§åˆ¶ç‚¹å—å½±å“
  - æ˜¾ç¤ºåŠ¨æ€éšœç¢ç‰©è´¡çŒ®çš„æ€»æˆæœ¬

---

## ğŸ§ª éªŒè¯æµ‹è¯•æŒ‡å—

### æµ‹è¯•1ï¼šç¡®è®¤è¯é¢˜é€šä¿¡

é‡æ–°å¯åŠ¨ç³»ç»Ÿåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åœ¨Dockerå®¹å™¨å†…æ‰§è¡Œ
docker exec 65abafec5dc5 bash -c "source /home/developer/ros_ws/ddo-topo-mppi/devel/setup.bash && \
  echo '=== 1. æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ ===' && \
  rosnode list | grep -E '(dynamic|ego_planner)' && \
  echo && \
  echo '=== 2. æ£€æŸ¥è¯é¢˜åˆ—è¡¨ ===' && \
  rostopic list | grep dynamic && \
  echo && \
  echo '=== 3. æ£€æŸ¥è¯é¢˜ä¿¡æ¯ ===' && \
  rostopic info /dynamic_obstacles/predicted_paths"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
=== 1. æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ ===
/dynamic_obstacle_generator
/ego_planner_node

=== 2. æ£€æŸ¥è¯é¢˜åˆ—è¡¨ ===
/dynamic_obstacles/predicted_paths

=== 3. æ£€æŸ¥è¯é¢˜ä¿¡æ¯ ===
Type: visualization_msgs/MarkerArray
Publishers: 
 * /dynamic_obstacle_generator (...)
Subscribers: 
 * /ego_planner_node (...)
```

---

### æµ‹è¯•2ï¼šæ£€æŸ¥è¯é¢˜å‘å¸ƒé¢‘ç‡

```bash
docker exec 65abafec5dc5 bash -c "source /home/developer/ros_ws/ddo-topo-mppi/devel/setup.bash && \
  timeout 5 rostopic hz /dynamic_obstacles/predicted_paths"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
average rate: 30.012
        min: 0.032s max: 0.034s std dev: 0.00058s window: 150
```
- âœ… å‘å¸ƒé¢‘ç‡åº”çº¦30Hz
- âš ï¸ å¦‚æœæŠ¥é”™"no messages received"ï¼Œè¯´æ˜è¯é¢˜æœªå‘å¸ƒ

---

### æµ‹è¯•3ï¼šæŸ¥çœ‹é¢„æµ‹æ•°æ®å†…å®¹

```bash
docker exec 65abafec5dc5 bash -c "source /home/developer/ros_ws/ddo-topo-mppi/devel/setup.bash && \
  timeout 2 rostopic echo /dynamic_obstacles/predicted_paths -n 1"
```

**é¢„æœŸè¾“å‡ºï¼š**
```yaml
markers:
  - 
    header: ...
    ns: "predicted_trajectories"
    id: 0
    type: 4  # LINE_STRIP
    action: 0
    points:
      - {x: 1.23, y: 2.34, z: 1.0}
      - {x: 1.25, y: 2.36, z: 1.0}
      - ...
      # åº”è¯¥æœ‰çº¦50ä¸ªç‚¹ï¼ˆ5ç§’é¢„æµ‹ / 0.1ç§’åˆ†è¾¨ç‡ï¼‰
    ...
  - id: 1
    ...
  # åº”è¯¥æœ‰8ä¸ªmarkerï¼ˆ8ä¸ªåŠ¨æ€éšœç¢ç‰©ï¼‰
```

---

### æµ‹è¯•4ï¼šæŸ¥çœ‹æ–°å¢è¯Šæ–­æ—¥å¿—

é‡æ–°å¯åŠ¨ROSç³»ç»Ÿå¹¶ç‚¹å‡»å¯¼èˆªç›®æ ‡åï¼Œåœ¨è§„åˆ’å™¨è¾“å‡ºä¸­æŸ¥æ‰¾æ–°å¢çš„è¯Šæ–­ä¿¡æ¯ï¼š

**æœŸæœ›çœ‹åˆ°çš„æ—¥å¿—ï¼ˆå¦‚æœç³»ç»Ÿæ­£å¸¸å·¥ä½œï¼‰ï¼š**
```
[INFO] [GridMap] ğŸ“¡ Received 8 dynamic obstacle predictions
[INFO] [GridMap] ğŸ¯ Dynamic obstacle detected: dist=2.34m at t=0.50s
[INFO] [BsplineOpt] ğŸš¨ Dynamic obstacles affecting 3 control points, total cost=0.127
```

**å¦‚æœç³»ç»Ÿå­˜åœ¨é—®é¢˜ï¼Œä¼šçœ‹åˆ°ï¼š**
```
[WARN] [GridMap] âš ï¸  No dynamic predictions available
[WARN] [GridMap] âš ï¸  Predictions expired (1.23s old)
```

---

### æµ‹è¯•5ï¼šå¯¹æ¯”æµ‹è¯•ï¼ˆéªŒè¯åŠ¨æ€é¿éšœæ•ˆæœï¼‰

#### 5.1 åŸºå‡†æµ‹è¯•ï¼ˆæ— åŠ¨æ€éšœç¢ç‰©ï¼‰
1. ä¿®æ”¹launchæ–‡ä»¶ï¼Œç¦ç”¨ `dynamic_obstacle_generator` èŠ‚ç‚¹
2. åœ¨é™æ€åœ°å›¾ä¸­ç‚¹å‡»ç›®æ ‡ï¼Œè®°å½•ï¼š
   - è·¯å¾„é•¿åº¦
   - è§„åˆ’æ—¶é—´
   - MPPIæˆæœ¬

#### 5.2 åŠ¨æ€é¿éšœæµ‹è¯•
1. å¯ç”¨æ‰€æœ‰åŠ¨æ€éšœç¢ç‰©ï¼ˆ8ä¸ªï¼‰
2. é€‰æ‹©ç›¸åŒçš„èµ·ç‚¹å’Œç›®æ ‡
3. è®°å½•ç›¸åŒæŒ‡æ ‡ï¼Œå¹¶è§‚å¯Ÿï¼š
   - è½¨è¿¹æ˜¯å¦ç»•å¼€ç§»åŠ¨éšœç¢ç‰©
   - æ˜¯å¦æœ‰åŠ¨æ€æˆæœ¬æ—¥å¿—è¾“å‡º
   - é‡è§„åˆ’é¢‘ç‡æ˜¯å¦å¢åŠ 

#### 5.3 è¿‘è·ç¦»æµ‹è¯•
1. ä¿®æ”¹ `dynamic_obstacle_generator` å‚æ•°ï¼Œå¢åŠ éšœç¢ç‰©å¯†åº¦
2. å°†ç›®æ ‡ç‚¹è®¾ç½®åœ¨éšœç¢ç‰©ç§»åŠ¨è·¯å¾„ä¸Š
3. è§‚å¯Ÿæ— äººæœºæ˜¯å¦ä¸»åŠ¨é¿è®©

---

## ğŸ“Š é¢„æœŸæ€§èƒ½æŒ‡æ ‡

### è®¡ç®—æ€§èƒ½
- **æ•°å€¼æ¢¯åº¦è®¡ç®—å¼€é”€ï¼š**
  - æ¯ä¸ªæ§åˆ¶ç‚¹ï¼š6æ¬¡ `getDynamicDistance()` è°ƒç”¨ï¼ˆÂ±x, Â±y, Â±zï¼‰
  - å…¸å‹è½¨è¿¹ï¼š20ä¸ªæ§åˆ¶ç‚¹ Ã— 6 = 120æ¬¡è·ç¦»æŸ¥è¯¢
  - æ¯æ¬¡æŸ¥è¯¢ï¼š8ä¸ªéšœç¢ç‰© Ã— æ’å€¼è®¡ç®— â‰ˆ 0.01ms
  - **æ€»å¼€é”€ï¼š**çº¦1.2ms per iteration
  - âœ… **ç›®æ ‡ï¼š**< 5msï¼Œä¸å½±å“å®æ—¶æ€§

### é¿éšœæ•ˆæœ
- **å®‰å…¨è·ç¦»ï¼š**
  - æœ€å°é—´éš™åº” > `clearance` = 0.5m
  - é¢„æµ‹è¯¯å·®è¡¥å¿ï¼š+0.3m buffer
  - âœ… **ç›®æ ‡ï¼š**ä¿æŒ > 0.8m å®‰å…¨è·ç¦»

- **é¢„æµ‹å‡†ç¡®æ€§ï¼š**
  - çº¿æ€§è¿åŠ¨ï¼šè¯¯å·® < 0.1m @ 0.5s
  - åœ†å‘¨è¿åŠ¨ï¼šè¯¯å·® < 0.2m @ 0.5s
  - é’Ÿæ‘†è¿åŠ¨ï¼šè¯¯å·® < 0.3m @ 0.5s
  - éšæœºè¿åŠ¨ï¼šè¯¯å·®è¾ƒå¤§ï¼Œä¾èµ–å¿«é€Ÿé‡è§„åˆ’

### è§„åˆ’æˆåŠŸç‡
- **é™æ€ç¯å¢ƒï¼š**åº”ç»´æŒ100%æˆåŠŸç‡
- **ä½å¯†åº¦åŠ¨æ€ç¯å¢ƒï¼ˆ<5ä¸ªéšœç¢ç‰©ï¼‰ï¼š**> 95%
- **é«˜å¯†åº¦åŠ¨æ€ç¯å¢ƒï¼ˆ8ä¸ªéšœç¢ç‰©ï¼‰ï¼š**> 85%

---

## ğŸ” æ•…éšœæ’æŸ¥æ¸…å•

### é—®é¢˜1ï¼šçœ‹ä¸åˆ°åŠ¨æ€é¢„æµ‹æ—¥å¿—

**ç—‡çŠ¶ï¼š**
```
[WARN] [GridMap] âš ï¸  No dynamic predictions available
```

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥ `dynamic_obstacle_generator` èŠ‚ç‚¹æ˜¯å¦å¯åŠ¨
   ```bash
   rosnode list | grep dynamic
   ```
2. æ£€æŸ¥è¯é¢˜æ˜¯å¦å‘å¸ƒ
   ```bash
   rostopic list | grep predicted_paths
   rostopic hz /dynamic_obstacles/predicted_paths
   ```
3. æ£€æŸ¥è®¢é˜…æ˜¯å¦å»ºç«‹
   ```bash
   rostopic info /dynamic_obstacles/predicted_paths
   ```
   åº”è¯¥æ˜¾ç¤º1ä¸ªpublisherå’Œ1ä¸ªsubscriber

**å¯èƒ½åŸå› ï¼š**
- âŒ `dynamic_obstacle_generator` æœªåœ¨launchæ–‡ä»¶ä¸­å¯åŠ¨
- âŒ è¯é¢˜åç§°æ‹¼å†™é”™è¯¯
- âŒ `grid_map::initMap()` æœªæ‰§è¡Œï¼ˆèŠ‚ç‚¹å¯åŠ¨å¤±è´¥ï¼‰

---

### é—®é¢˜2ï¼šé¢„æµ‹æ•°æ®è¿‡æœŸ

**ç—‡çŠ¶ï¼š**
```
[WARN] [GridMap] âš ï¸  Predictions expired (1.50s old)
```

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥å‘å¸ƒé¢‘ç‡æ˜¯å¦æ­£å¸¸
   ```bash
   rostopic hz /dynamic_obstacles/predicted_paths
   ```
   åº”è¯¥çº¦30Hz
2. æ£€æŸ¥ç³»ç»Ÿæ—¶é’Ÿæ˜¯å¦åŒæ­¥
   ```bash
   rostopic echo /clock -n 1
   ```

**å¯èƒ½åŸå› ï¼š**
- âŒ `dynamic_obstacle_generator` å‘å¸ƒé¢‘ç‡è¿‡ä½
- âŒ ç½‘ç»œå»¶è¿Ÿï¼ˆä¸å¤ªå¯èƒ½åœ¨æœ¬åœ°æµ‹è¯•ä¸­ï¼‰
- âŒ ç³»ç»Ÿè´Ÿè½½è¿‡é«˜å¯¼è‡´å›è°ƒå»¶è¿Ÿ

---

### é—®é¢˜3ï¼šæ£€æµ‹ä¸åˆ°è¿‘è·ç¦»éšœç¢ç‰©

**ç—‡çŠ¶ï¼š**
- è§„åˆ’å™¨æ—¥å¿—æ­£å¸¸
- ä½†ä»ä¸è¾“å‡º "ğŸ¯ Dynamic obstacle detected"

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥éšœç¢ç‰©æ˜¯å¦çœŸçš„æ¥è¿‘æ— äººæœº
   ```bash
   rostopic echo /dynamic_obstacles/predicted_paths -n 1
   ```
   æŸ¥çœ‹ `points` æ•°ç»„ä¸­çš„åæ ‡
2. æ£€æŸ¥æ— äººæœºå½“å‰ä½ç½®
   ```bash
   rostopic echo /visual_slam/odom -n 1
   ```
3. æ‰‹åŠ¨è®¡ç®—è·ç¦»æ˜¯å¦ < 5ç±³

**å¯èƒ½åŸå› ï¼š**
- âœ… è¿™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼éšœç¢ç‰©ç¡®å®ç¦»å¾—è¿œ
- è§£å†³æ–¹æ¡ˆï¼šå¢åŠ éšœç¢ç‰©å¯†åº¦æˆ–è°ƒæ•´å…¶è¿åŠ¨èŒƒå›´

---

### é—®é¢˜4ï¼šåŠ¨æ€æˆæœ¬å§‹ç»ˆä¸º0

**ç—‡çŠ¶ï¼š**
- çœ‹åˆ° "ğŸ“¡ Received predictions" æ—¥å¿—
- çœ‹åˆ° "ğŸ¯ Dynamic obstacle detected" æ—¥å¿—
- ä½†ä»ä¸è¾“å‡º "ğŸš¨ Dynamic obstacles affecting"

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ£€æµ‹è·ç¦»å’Œæˆæœ¬é˜ˆå€¼
   - éšœç¢ç‰©è·ç¦» < `3.0 * clearance` â‰ˆ 1.5ç±³ æ‰ä¼šäº§ç”Ÿæˆæœ¬
   - æœ€è¿‘æ£€æµ‹è·ç¦»æ˜¯å¤šå°‘ï¼Ÿï¼ˆä»å‰é¢çš„æ—¥å¿—è·å–ï¼‰

2. æ£€æŸ¥æ—¶é—´è®¡ç®—
   åœ¨ `bspline_optimizer.cpp` ä¸­ä¸´æ—¶æ·»åŠ ï¼š
   ```cpp
   ROS_INFO("Control point %d: time_from_now=%.2fs, dynamic_dist=%.2fm", 
            i, time_from_now, dynamic_dist);
   ```

**å¯èƒ½åŸå› ï¼š**
- âœ… éšœç¢ç‰©è™½ç„¶æ¥è¿‘å½“å‰ä½ç½®ï¼Œä½†é¢„æµ‹çš„æœªæ¥ä½ç½®å·²ç»è¿œç¦»
- âœ… è¿™è¯´æ˜é¢„æµ‹ç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼Œæ— äººæœºå·²ç»è§„åˆ’äº†é¿è®©è½¨è¿¹
- è§£å†³æ–¹æ¡ˆï¼šè®¾è®¡æ›´æç«¯çš„æµ‹è¯•åœºæ™¯ï¼ˆè¿é¢ç›¸æ’ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### ä¼˜åŒ–1ï¼šå‡å°‘æ¢¯åº¦è®¡ç®—å¼€é”€

**å½“å‰å®ç°ï¼š**æ¯ä¸ªæ§åˆ¶ç‚¹è°ƒç”¨6æ¬¡ `getDynamicDistance()`

**æ”¹è¿›æ–¹æ¡ˆï¼š**è§£ææ¢¯åº¦è®¡ç®—
```cpp
// åœ¨ grid_map ä¸­æ·»åŠ æ–°å‡½æ•°
void GridMap::getDynamicDistanceWithGradient(
    const Eigen::Vector3d& pos, 
    double time_from_now,
    double& dist,
    Eigen::Vector3d& grad)
{
  // ä¸€æ¬¡éå†åŒæ—¶è®¡ç®—è·ç¦»å’Œæ¢¯åº¦
  // æ¢¯åº¦ = (pos - predicted_pos).normalized()
  // æ€§èƒ½æå‡ï¼š6å€
}
```

**é¢„æœŸæ”¶ç›Šï¼š**
- è®¡ç®—å¼€é”€ä» 1.2ms â†’ 0.2ms
- æ›´é€‚åˆé«˜é¢‘é‡è§„åˆ’

---

### ä¼˜åŒ–2ï¼šè‡ªé€‚åº”é¢„æµ‹çª—å£

**å½“å‰å®ç°ï¼š**å›ºå®š0.5ç§’é¢„æµ‹æœ‰æ•ˆæœŸ

**æ”¹è¿›æ–¹æ¡ˆï¼š**
```cpp
double prediction_horizon = std::min(
    0.5, 
    traj_duration  // ä½¿ç”¨å®é™…è½¨è¿¹æ—¶é•¿
);
```

**é¢„æœŸæ”¶ç›Šï¼š**
- é•¿è·ç¦»è§„åˆ’ï¼šæ‰©å±•é¢„æµ‹çª—å£è‡³1-2ç§’
- çŸ­è·ç¦»è§„åˆ’ï¼šä¿æŒ0.5ç§’å‡å°‘è®¡ç®—

---

### ä¼˜åŒ–3ï¼šåŠ¨æ€é˜ˆå€¼è°ƒæ•´

**å½“å‰å®ç°ï¼š**å›ºå®š `3.0 * clearance`

**æ”¹è¿›æ–¹æ¡ˆï¼š**
```cpp
double dynamic_threshold = std::max(
    2.0 * clearance,  // æœ€å°é˜ˆå€¼
    obstacle_velocity * prediction_horizon  // é€Ÿåº¦ç›¸å…³
);
```

**é¢„æœŸæ”¶ç›Šï¼š**
- å¿«é€Ÿéšœç¢ç‰©ï¼šæ›´æ—©è§¦å‘é¿è®©
- æ…¢é€Ÿéšœç¢ç‰©ï¼šå‡å°‘ä¸å¿…è¦çš„æˆæœ¬è®¡ç®—

---

### ä¼˜åŒ–4ï¼šé¢„æµ‹ä¸ç¡®å®šæ€§å»ºæ¨¡

**å½“å‰å®ç°ï¼š**æ‰€æœ‰é¢„æµ‹ç‚¹è§†ä¸ºç¡®å®šæ€§

**æ”¹è¿›æ–¹æ¡ˆï¼š**
```cpp
struct DynamicObstaclePrediction {
  std::vector<Eigen::Vector3d> predicted_positions;
  std::vector<double> confidence;  // æ¯ä¸ªç‚¹çš„ç½®ä¿¡åº¦ [0,1]
  double motion_type_confidence;    // è¿åŠ¨æ¨¡å‹ç½®ä¿¡åº¦
};

// æˆæœ¬è®¡ç®—è€ƒè™‘ä¸ç¡®å®šæ€§
double effective_clearance = clearance + (1.0 - confidence) * 0.5;
```

**é¢„æœŸæ”¶ç›Šï¼š**
- æ›´ä¿å®ˆçš„è¿œè·ç¦»é¢„æµ‹
- æ›´å‡†ç¡®çš„è¿‘è·ç¦»é¢„æµ‹

---

## ğŸ“ æ€»ç»“

### å·²å®Œæˆçš„å·¥ä½œ âœ…
1. **Phase 1-3ï¼š**å®Œæ•´å®ç°åŠ¨æ€éšœç¢ç‰©é¢„æµ‹ä¸è½¨è¿¹ä¼˜åŒ–é›†æˆ
2. **ç¼–è¯‘éªŒè¯ï¼š**æ‰€æœ‰ä»£ç æˆåŠŸç¼–è¯‘ï¼Œæ— é‡å¤§é”™è¯¯
3. **è¯Šæ–­å¢å¼ºï¼š**æ·»åŠ 4ç±»å…³é”®æ—¥å¿—ï¼Œè¦†ç›–æ•´ä¸ªæ•°æ®æµ
4. **æ–‡æ¡£å®Œå–„ï¼š**åˆ›å»ºæµ‹è¯•æŒ‡å—å’Œæ•…éšœæ’æŸ¥æ‰‹å†Œ

### å¾…éªŒè¯çš„åŠŸèƒ½ â³
1. **è¯é¢˜é€šä¿¡ï¼š**ç¡®è®¤ `/dynamic_obstacles/predicted_paths` æ­£å¸¸å‘å¸ƒ
2. **æ•°æ®æ¥æ”¶ï¼š**ç¡®è®¤ `grid_map` æˆåŠŸè®¢é˜…å¹¶è§£æé¢„æµ‹
3. **æˆæœ¬è®¡ç®—ï¼š**ç¡®è®¤ bsplineä¼˜åŒ–å™¨ ä½¿ç”¨åŠ¨æ€è·ç¦»
4. **é¿éšœæ•ˆæœï¼š**å¯¹æ¯”æœ‰æ— åŠ¨æ€é¢„æµ‹çš„è½¨è¿¹å·®å¼‚

### æµ‹è¯•å»ºè®® ğŸ§ª
1. æŒ‰ç…§"éªŒè¯æµ‹è¯•æŒ‡å—"ä¾æ¬¡æ‰§è¡Œ5ä¸ªæµ‹è¯•
2. æ”¶é›†å®Œæ•´çš„rostopicè¾“å‡ºå’Œè§„åˆ’å™¨æ—¥å¿—
3. é‡ç‚¹å…³æ³¨æ–°å¢çš„4ç±»è¯Šæ–­æ—¥å¿—ï¼ˆğŸ“¡ ğŸ¯ ğŸš¨ âš ï¸ï¼‰
4. å¦‚æœçœ‹ä¸åˆ°åŠ¨æ€æˆæœ¬æ—¥å¿—ï¼Œå°è¯•"è¿‘è·ç¦»æµ‹è¯•"åœºæ™¯

### é¢„æœŸç»“æœ ğŸ¯
- âœ… **æ­£å¸¸æƒ…å†µï¼š**çœ‹åˆ° "ğŸ“¡ Received" å’Œ "ğŸš¨ affecting" æ—¥å¿—
- âœ… **è¾¹ç•Œæƒ…å†µï¼š**åªçœ‹åˆ° "ğŸ“¡ Received"ï¼ˆéšœç¢ç‰©å¤ªè¿œï¼‰
- âš ï¸ **å¼‚å¸¸æƒ…å†µï¼š**çœ‹åˆ° "âš ï¸ No predictions" æˆ– "âš ï¸ expired"
