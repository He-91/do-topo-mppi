<launch>
  <!-- ============================================ -->
  <!-- 静态+动态障碍物综合测试                        -->
  <!-- ============================================ -->
  
  <!-- 使用真实时间 -->
  <param name="/use_sim_time" value="false"/>
  
  <!-- 地图尺寸 -->
  <arg name="map_size_x" value="40.0"/>
  <arg name="map_size_y" value="20.0"/>
  <arg name="map_size_z" value=" 5.0"/>
  
  <arg name="init_x" value="-19.0"/>
  <arg name="init_y" value="0.0"/>
  <arg name="init_z" value="1.0"/>

  <!-- ============================================ -->
  <!-- 1. 静态障碍物地图生成器                        -->
  <!-- ============================================ -->
  <node pkg="map_generator" name="random_forest" type="random_forest" output="screen">    
    <param name="init_state_x"   value="$(arg init_x)"/>
    <param name="init_state_y"   value="$(arg init_y)"/>
    <param name="map/x_size"     value="$(arg map_size_x)" />
    <param name="map/y_size"     value="$(arg map_size_y)" />
    <param name="map/z_size"     value="$(arg map_size_z)" />
    <param name="map/resolution" value="0.1"/>
    
    <!-- 减少静态障碍物数量，为动态障碍物留空间 -->
    <param name="map/obs_num"    value="100"/>  <!-- 柱状障碍物 -->
    <param name="map/circle_num" value="5"/>    <!-- 圆形障碍物 -->
    
    <param name="ObstacleShape/lower_rad" value="0.5"/>
    <param name="ObstacleShape/upper_rad" value="0.7"/>
    <param name="ObstacleShape/lower_hei" value="0.0"/>
    <param name="ObstacleShape/upper_hei" value="3.0"/>
    
    <param name="ObstacleShape/radius_l" value="0.7"/>
    <param name="ObstacleShape/radius_h" value="0.5"/>
    <param name="ObstacleShape/z_l" value="0.7"/>
    <param name="ObstacleShape/z_h" value="0.8"/>
    <param name="ObstacleShape/theta" value="0.5"/>
    
    <param name="sensing/radius" value="100.0"/>
    <param name="sensing/rate"   value="10.0"/>
    <param name="min_distance"   value="1.0"/>
  </node>

  <!-- ============================================ -->
  <!-- 2. 动态障碍物生成器                            -->
  <!-- ============================================ -->
  <node pkg="map_generator" type="dynamic_obstacle_generator" name="dynamic_obstacle_generator" output="screen">
    <param name="map/x_size" value="$(arg map_size_x)" />
    <param name="map/y_size" value="$(arg map_size_y)" />
    <param name="map/z_size" value="$(arg map_size_z)" />
    
    <param name="dynamic_obstacles/update_rate" value="20.0" />
    <param name="dynamic_obstacles/resolution" value="0.15" />
    
    <!-- 各类动态障碍物数量 -->
    <param name="dynamic_obstacles/num_linear" value="3" />
    <param name="dynamic_obstacles/num_circular" value="2" />
    <param name="dynamic_obstacles/num_pendulum" value="2" />
    <param name="dynamic_obstacles/num_random" value="1" />
  </node>

  <!-- ============================================ -->
  <!-- 3. 点云融合节点（合并静态+动态）                -->
  <!-- ============================================ -->
  <node pkg="map_generator" type="cloud_merger" name="cloud_merger" output="screen">
    <remap from="~static_cloud" to="/map_generator/global_cloud"/>
    <remap from="~dynamic_cloud" to="/dynamic_obstacles/cloud"/>
    <remap from="~merged_cloud" to="/combined_obstacles/cloud"/>
    <param name="publish_rate" value="20.0"/>
  </node>

  <!-- ============================================ -->
  <!-- 4. RViz可视化                                -->
  <!-- ============================================ -->
  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find ego_planner)/launch/combined_obstacles.rviz" required="false"/>

</launch>
