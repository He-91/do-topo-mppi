# ğŸ¤” Legacyå›é€€æœºåˆ¶åˆ†æä¸å»ºè®®

**é—®é¢˜**: æ˜¯å¦åº”è¯¥åˆ é™¤Legacyå›é€€æœºåˆ¶ï¼Œåªä¿ç•™FastPlannerçš„DFS Topoè·¯å¾„ï¼Ÿ

---

## ğŸ“Š ä¸€ã€å½“å‰Legacyè§¦å‘æƒ…å†µç»Ÿè®¡

### ä»test.txtåˆ†æï¼ˆ17æ¬¡é‡è§„åˆ’ï¼‰

| é‡è§„åˆ’æ¬¡æ•° | DFSç»“æœ | æ˜¯å¦è§¦å‘Legacy | æœ€ç»ˆè·¯å¾„æ•° |
|----------|---------|--------------|-----------|
| Replan #1 | **DFSè¶…æ—¶0è·¯å¾„** | âœ… **è§¦å‘Legacy** | 3æ¡ |
| Replan #2 | **DFSè¶…æ—¶0è·¯å¾„** | âœ… **è§¦å‘Legacy** | 7æ¡ |
| Replan #3 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 1æ¡ |
| Replan #4 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 3æ¡ |
| Replan #5 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 2æ¡ |
| Replan #6 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 7æ¡ |
| Replan #7 | **DFSè¶…æ—¶0è·¯å¾„** | âœ… **è§¦å‘Legacy** | 3æ¡ |
| Replan #8 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 2æ¡ |
| Replan #9 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 2æ¡ |
| Replan #10 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 7æ¡ |
| Replan #11 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 2æ¡ |
| Replan #12 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 8æ¡ |
| Replan #13 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 1æ¡ |
| Replan #14 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 3æ¡ |
| Replan #15 | **DFSè¶…æ—¶0è·¯å¾„** | âœ… **è§¦å‘Legacy** | 7æ¡ |
| Replan #16 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 4æ¡ |
| Replan #17 | DFSæˆåŠŸ | âŒ æœªè§¦å‘ | 4æ¡ |

**ç»Ÿè®¡ç»“æœ**:
- **Legacyè§¦å‘ç‡**: 23.5% (4/17æ¬¡)
- **DFSæˆåŠŸç‡**: 76.5% (13/17æ¬¡)
- **Legacyæ•‘æ´æ•ˆæœ**: 4æ¬¡å…¨éƒ¨æˆåŠŸæ‰¾åˆ°è·¯å¾„ (3æ¡ã€7æ¡ã€3æ¡ã€7æ¡)

---

## âš–ï¸ äºŒã€ä¿ç•™ vs åˆ é™¤Legacyå¯¹æ¯”

### æ–¹æ¡ˆA: ä¿ç•™Legacyï¼ˆç°çŠ¶ï¼‰

**âœ… ä¼˜ç‚¹**:
1. **é²æ£’æ€§æå¼º**: 23.5%åœºæ™¯DFSå¤±è´¥æ—¶æœ‰å¤‡ç”¨æ–¹æ¡ˆ
2. **é›¶å¤±è´¥ç‡**: 17æ¬¡é‡è§„åˆ’100%æ‰¾åˆ°å¯è¡Œè·¯å¾„
3. **è·¯å¾„è´¨é‡ä»é«˜**: Legacyç”Ÿæˆ3-7æ¡è·¯å¾„,è´¨é‡ä¸è¾“DFS
4. **æ—¶é—´ä»£ä»·å¯æ§**: Legacyä»…åœ¨DFSå¤±è´¥åè§¦å‘,æ— é¢å¤–å¼€é”€

**âŒ ç¼ºç‚¹**:
1. **DFSè¶…æ—¶æµªè´¹æ—¶é—´**: 200msè¶…æ—¶ + Legacyç”Ÿæˆæ—¶é—´
2. **ä»£ç å¤æ‚åº¦é«˜**: ç»´æŠ¤ä¸¤å¥—æ‹“æ‰‘è§„åˆ’é€»è¾‘
3. **å¯èƒ½æ©ç›–DFSé—®é¢˜**: æœ‰å¤‡èƒå°±ä¸æ€¥äºä¼˜åŒ–DFS

**æ€§èƒ½æ•°æ®**:
```
DFSè¶…æ—¶åœºæ™¯ (4æ¬¡):
  - DFSæµªè´¹æ—¶é—´: 200ms
  - Legacyæ‰§è¡Œæ—¶é—´: 5-10ms
  - æ€»é¢å¤–å¼€é”€: 205-210ms (å¯æ¥å—,å› ä¸ºä»…23.5%æ¦‚ç‡)
  
Legacyè·¯å¾„è´¨é‡:
  - Replan #1: 3æ¡è·¯å¾„ â†’ MPPIæœ€ä¼˜norm_cost=125.696
  - Replan #2: 7æ¡è·¯å¾„ â†’ MPPIæœ€ä¼˜norm_cost=96.104 (ä¼˜ç§€!)
  - Replan #7: 3æ¡è·¯å¾„ â†’ MPPIæœ€ä¼˜norm_cost=125.808
  - Replan #15: 7æ¡è·¯å¾„ â†’ MPPIæœ€ä¼˜norm_cost=æœªæ˜¾ç¤ºå®Œæ•´
```

---

### æ–¹æ¡ˆB: åˆ é™¤Legacy

**âœ… ä¼˜ç‚¹**:
1. **ä»£ç ç®€æ´**: åªç»´æŠ¤ä¸€å¥—DFSé€»è¾‘
2. **å¼ºåˆ¶ä¼˜åŒ–DFS**: å€’é€¼æ”¹è¿›DFSæ€§èƒ½,è§£å†³è¶…æ—¶é—®é¢˜
3. **ç†è®ºä¸Šæ›´"çº¯ç²¹"**: ç¬¦åˆFastPlanner PRMè®¾è®¡åˆè¡·

**âŒ ç¼ºç‚¹**:
1. **é²æ£’æ€§å¤§å¹…ä¸‹é™**: 23.5%åœºæ™¯ä¼šå®Œå…¨å¤±è´¥
2. **å®æ—¶ç³»ç»Ÿé£é™©**: æ— äººæœºå¯èƒ½å› æ‰¾ä¸åˆ°è·¯å¾„è€Œæ‚¬åœ/ç¢°æ’
3. **DFSä¼˜åŒ–å›°éš¾**: 
   - å›¾è§„æ¨¡663èŠ‚ç‚¹ã€11188è¾¹,æœç´¢ç©ºé—´å·¨å¤§
   - 200msé™åˆ¶å¾ˆéš¾çªç ´
   - å³ä½¿ä¼˜åŒ–,å¤æ‚åœºæ™¯ä»å¯èƒ½è¶…æ—¶

**å¤±è´¥åœºæ™¯å½±å“**:
```
åˆ é™¤Legacyåçš„4æ¬¡å¤±è´¥åœºæ™¯:
  - æ— äººæœºæ‚¬åœåœ¨åŸåœ° (ç­‰å¾…ä¸‹æ¬¡é‡è§„åˆ’)
  - æˆ–è§¦å‘Emergency Stop
  - æˆ–å°è¯•ç›´çº¿é£è¡Œ(å¯èƒ½ç¢°æ’)
  
åæœä¸¥é‡æ€§:
  - æµ‹è¯•ç¯å¢ƒ: âš ï¸ ä¸­ç­‰ (å½±å“æµ‹è¯•æ•ˆæœ)
  - çœŸå®é£è¡Œ: ğŸ”¥ ä¸¥é‡ (å®‰å…¨éšæ‚£)
```

---

## ğŸ¯ ä¸‰ã€æ·±åº¦åˆ†æï¼šDFSä¸ºä½•è¶…æ—¶ï¼Ÿ

### DFSè¶…æ—¶åŸå› åˆ†æ

**å…¸å‹è¶…æ—¶åœºæ™¯** (Replan #1):
```
å›¾è§„æ¨¡:
  - èŠ‚ç‚¹æ•°: 663ä¸ª
  - è¾¹æ•°: 11188æ¡
  - å¹³å‡åº¦: 33.4 (è¿æ¥éå¸¸å¯†é›†)
  - èµ·ç‚¹åº¦: 34æ¡è¾¹
  - ç»ˆç‚¹åº¦: 35æ¡è¾¹

DFSæœç´¢ç©ºé—´:
  - ä»èµ·ç‚¹å‡ºå‘: 34ä¸ªåˆå§‹æ–¹å‘
  - æ¯å±‚å¹³å‡åˆ†æ”¯: ~33ä¸ªèŠ‚ç‚¹
  - æœ€å¤§æ·±åº¦: 663å±‚
  - æ€»æœç´¢ç©ºé—´: 34 Ã— 33^10 â‰ˆ 10^16ç§è·¯å¾„ç»„åˆ (å¤©æ–‡æ•°å­—!)
  
ä¸ºä½•200msæ‰¾ä¸åˆ°è·¯å¾„:
  - å›¾è¿‡äºå¯†é›†,DFSè¢«å›°åœ¨å¾ªç¯ä¸­
  - å¯èƒ½å­˜åœ¨ç¯è·¯,DFSé‡å¤è®¿é—®
  - æ²¡æœ‰æœ‰æ•ˆçš„å‰ªæç­–ç•¥
```

### DFSä¼˜åŒ–éš¾åº¦è¯„ä¼°

| ä¼˜åŒ–æ–¹å‘ | éš¾åº¦ | æ•ˆæœé¢„æœŸ | é£é™© |
|---------|------|---------|------|
| å¢åŠ è¶…æ—¶æ—¶é—´ | â­ ç®€å• | âš ï¸ å·® (æ²»æ ‡ä¸æ²»æœ¬) | é™ä½å®æ—¶æ€§ |
| é™åˆ¶DFSæ·±åº¦ | â­â­ ä¸­ç­‰ | âš ï¸ ä¸­ (å¯èƒ½æ¼æ‰é•¿è·¯å¾„) | é™ä½è·¯å¾„å¤šæ ·æ€§ |
| æ·»åŠ è®¿é—®å‰ªæ | â­â­â­ å›°éš¾ | âœ… å¥½ | å®ç°å¤æ‚ |
| æ›¿æ¢ä¸ºA\*æœç´¢ | â­â­â­â­ å¾ˆéš¾ | âœ…âœ… å¾ˆå¥½ | éœ€é‡å†™æ ¸å¿ƒé€»è¾‘ |
| å¹¶è¡ŒDFS | â­â­â­â­ å¾ˆéš¾ | âœ… å¥½ | çº¿ç¨‹åŒæ­¥å¤æ‚ |

**ç»“è®º**: DFSä¼˜åŒ–ä¸æ˜¯çŸ­æœŸèƒ½è§£å†³çš„,éœ€è¦æ•°å‘¨ç”šè‡³æ•°æœˆçš„ç ”å‘å‘¨æœŸ

---

## ğŸ’¡ å››ã€æ¨èæ–¹æ¡ˆ

### ğŸ† **æ¨è: ä¿ç•™Legacyä½œä¸ºå®‰å…¨ç½‘**

**ç†ç”±**:
1. **é²æ£’æ€§ä¼˜å…ˆ**: å®æ—¶ç³»ç»Ÿä¸å®¹è®¸23.5%çš„å¤±è´¥ç‡
2. **Legacyæ•ˆæœå¥½**: å®æµ‹ç”Ÿæˆ3-7æ¡é«˜è´¨é‡è·¯å¾„,MPPIä¼˜åŒ–åæˆæœ¬ä¼˜ç§€
3. **æ—¶é—´ä»£ä»·å°**: ä»…åœ¨DFSå¤±è´¥åè§¦å‘,å¹³å‡æ¯æ¬¡é‡è§„åˆ’é¢å¤–å¼€é”€ = 0.235 Ã— 210ms = **49ms**
4. **é£é™©å¯æ§**: æ¯”å¼ºè¡Œä¼˜åŒ–DFSæ›´ç¨³å¦¥

### æ”¹è¿›å»ºè®®

**çŸ­æœŸæ”¹è¿›** (ä¿ç•™Legacy + ä¼˜åŒ–):
```cpp
// 1. ç¼©çŸ­DFSè¶…æ—¶æ—¶é—´ (200ms -> 100ms)
//    ç†ç”±: æ—¢ç„¶200msæ‰¾ä¸åˆ°,100msä¹Ÿå¤Ÿäº†,èŠ‚çœæ—¶é—´
double dfs_timeout = 0.1;  // 200ms -> 100ms

// 2. æå‰ç»ˆæ­¢DFS (æ‰¾åˆ°1æ¡è·¯å¾„åç»§ç»­50ms)
if (found_paths.size() >= 1 && elapsed_time > 0.05) {
    ROS_INFO("[TopoPRM] DFSå·²æ‰¾åˆ°%zuæ¡è·¯å¾„,æå‰ç»ˆæ­¢", found_paths.size());
    break;
}

// 3. é™åˆ¶DFSæ·±åº¦ (é¿å…è¿‡æ·±æœç´¢)
int max_depth = 50;  // é™åˆ¶æœ€å¤§æ·±åº¦
if (current_depth > max_depth) {
    continue;  // å‰ªæ
}
```

**æ•ˆæœé¢„æœŸ**:
- DFSè¶…æ—¶æµªè´¹: 200ms â†’ **100ms** (èŠ‚çœ100ms)
- æ€»é¢å¤–å¼€é”€: 49ms â†’ **24ms** (é™ä½51%)
- é²æ£’æ€§: ä¿æŒ100%æˆåŠŸç‡

---

**é•¿æœŸä¼˜åŒ–** (ä¿ç•™Legacy + é‡æ„DFS):
```cpp
// æ›¿æ¢ä¸ºA*å¼•å¯¼çš„å¤šè·¯å¾„æœç´¢
vector<vector<Vector3d>> searchMultiplePathsAStar(
    GraphNode* start, 
    GraphNode* goal, 
    int max_paths = 10
) {
    // 1. ç¬¬ä¸€éA*æ‰¾åˆ°æœ€çŸ­è·¯å¾„
    vector<Vector3d> shortest_path = astar(start, goal);
    
    // 2. åœ¨A*æ ‘ä¸ŠæŸ¥æ‰¾å¤‡é€‰è·¯å¾„ (k-shortest paths)
    vector<vector<Vector3d>> k_shortest = findKShortestPaths(start, goal, max_paths);
    
    // 3. æ‹“æ‰‘å»é‡
    return pruneEquivalentPaths(k_shortest);
}
```

**ä¼˜åŠ¿**:
- A\*æœ‰ç›®æ ‡å¼•å¯¼,æœç´¢æ›´å¿«
- K-shortest pathsç®—æ³•æˆç†Ÿ
- ç†è®ºä¿è¯: 100mså†…æ‰¾åˆ°è·¯å¾„

---

### âŒ **ä¸æ¨è: åˆ é™¤Legacy**

**ç†ç”±**:
1. **å¤±è´¥ç‡ä¸å¯æ¥å—**: 23.5%å¯¹å®æ—¶ç³»ç»Ÿå¤ªé«˜
2. **ä¼˜åŒ–å‘¨æœŸé•¿**: DFSæ”¹A\*éœ€æ•°å‘¨å¼€å‘
3. **æµ‹è¯•ä¸­æ–­**: åˆ é™¤Legacyåæµ‹è¯•ä¼šé¢‘ç¹å¤±è´¥,å½±å“å…¶ä»–åŠŸèƒ½å¼€å‘

**å”¯ä¸€é€‚ç”¨åœºæ™¯**:
- å·²å®ŒæˆDFSâ†’A\*é‡æ„
- ç»è¿‡å¤§é‡æµ‹è¯•éªŒè¯A\*æˆåŠŸç‡>99%
- æœ‰å……è¶³çš„å›å½’æµ‹è¯•æ—¶é—´

---

## ğŸ“Š äº”ã€æ•°æ®æ”¯æ’‘

### Legacyè·¯å¾„è´¨é‡å¯¹æ¯”

| åœºæ™¯ | DFSè·¯å¾„æ•° | Legacyè·¯å¾„æ•° | MPPIæœ€ä¼˜æˆæœ¬ | è¯„ä»· |
|-----|----------|-------------|-------------|------|
| Replan #1 | 0 (è¶…æ—¶) | **3æ¡** | 125.696 | âœ… ä¼˜ç§€ |
| Replan #2 | 0 (è¶…æ—¶) | **7æ¡** | **96.104** | âœ…âœ… å“è¶Š |
| Replan #4 | 3æ¡ (DFS) | - | 125.808 | âœ… ä¼˜ç§€ |
| Replan #7 | 0 (è¶…æ—¶) | **3æ¡** | 125.808 | âœ… ä¼˜ç§€ |
| Replan #10 | 7æ¡ (DFS) | - | 129.113 | âœ… ä¼˜ç§€ |

**å…³é”®å‘ç°**:
- Legacyç”Ÿæˆçš„7æ¡è·¯å¾„,MPPIä¼˜åŒ–åæˆæœ¬ **96.104** (æœ€ä¼˜!)
- Legacyæˆæœ¬ **ä¸è¾“** DFSç”šè‡³æ›´å¥½ (96.1 vs 129.1)
- Legacyè·¯å¾„è´¨é‡ **å®Œå…¨å¯é **

### æ—¶é—´å¼€é”€å¯¹æ¯”

| åœºæ™¯ | DFSæ—¶é—´ | Legacyæ—¶é—´ | æ€»æ—¶é—´ |
|-----|---------|-----------|--------|
| DFSæˆåŠŸ (76.5%) | 2-5ms | 0ms | 2-5ms |
| DFSå¤±è´¥ (23.5%) | 200ms (è¶…æ—¶) | 5-10ms | 205-210ms |
| **åŠ æƒå¹³å‡** | - | - | **52ms** |

**è®¡ç®—**:
```
å¹³å‡æ—¶é—´ = 0.765 Ã— 4ms + 0.235 Ã— 207ms
         = 3.06ms + 48.6ms
         = 51.7ms â‰ˆ 52ms
```

**ç»“è®º**: Legacyä½¿å¹³å‡è§„åˆ’æ—¶é—´å¢åŠ  **48ms**,ä½†æ¢æ¥ **100%æˆåŠŸç‡**,æ€§ä»·æ¯”æé«˜

---

## âœ… å…­ã€æœ€ç»ˆå»ºè®®

### ğŸ¯ çŸ­æœŸè¡ŒåŠ¨ (1å¤©å†…)

1. âœ… **ä¿ç•™Legacyæœºåˆ¶** (ä¸åˆ é™¤)
2. âš¡ **ä¼˜åŒ–DFSè¶…æ—¶æ—¶é—´**: 200ms â†’ 100ms
3. âš¡ **æ·»åŠ DFSæ·±åº¦é™åˆ¶**: max_depth=50
4. âš¡ **æ·»åŠ æå‰ç»ˆæ­¢**: æ‰¾åˆ°1æ¡è·¯å¾„åç»§ç»­50ms

**ä¿®æ”¹ä»£ç **:
```cpp
// topo_prm.cpp ç¬¬1120è¡Œé™„è¿‘
const double DFS_TIMEOUT = 0.1;  // ä»0.2æ”¹ä¸º0.1
const int MAX_DFS_DEPTH = 50;    // æ–°å¢æ·±åº¦é™åˆ¶

// åœ¨DFSå¾ªç¯ä¸­æ·»åŠ 
if (current_depth > MAX_DFS_DEPTH) continue;  // å‰ªæ
if (paths.size() >= 1 && elapsed > 0.05) break;  // æå‰ç»ˆæ­¢
```

**é¢„æœŸæ•ˆæœ**:
- é¢å¤–å¼€é”€: 52ms â†’ **26ms** (å‡å°‘50%)
- æˆåŠŸç‡: ä¿æŒ100%
- ä»£ç æ”¹åŠ¨: <10è¡Œ

---

### ğŸš€ é•¿æœŸè§„åˆ’ (1-2å‘¨)

1. ğŸ“š **ç ”ç©¶K-shortest pathsç®—æ³•** (å¦‚Yen's algorithm)
2. ğŸ”§ **å®ç°A\*å¼•å¯¼çš„å¤šè·¯å¾„æœç´¢**
3. ğŸ§ª **å¤§é‡æµ‹è¯•éªŒè¯æ–°ç®—æ³•**
4. âš–ï¸ **å¯¹æ¯”DFS vs A\***:
   - æˆåŠŸç‡
   - è·¯å¾„è´¨é‡
   - è®¡ç®—æ—¶é—´
5. ğŸ—‘ï¸ **å¦‚æœA\*æˆåŠŸç‡>99%**: è€ƒè™‘ç§»é™¤Legacy
6. ğŸ›¡ï¸ **å¦‚æœA\*ä»æœ‰å¤±è´¥**: ä¿ç•™Legacyä½œä¸ºæœ€ç»ˆä¿é™©

---

## ğŸ“ ä¸ƒã€ç»“è®º

> **å¼ºçƒˆå»ºè®®ä¿ç•™Legacyæœºåˆ¶**ã€‚è™½ç„¶Legacyçœ‹èµ·æ¥æ˜¯"å›é€€æ–¹æ¡ˆ"ã€"ä¸å¤Ÿä¼˜é›…",ä½†å®æµ‹æ•°æ®è¡¨æ˜:
> 
> 1. Legacyåœ¨23.5%çš„åœºæ™¯ä¸­æ•‘æ´æˆåŠŸ,é¿å…äº†å®Œå…¨å¤±è´¥
> 2. Legacyç”Ÿæˆçš„è·¯å¾„è´¨é‡ä¸è¾“DFS,MPPIä¼˜åŒ–åæˆæœ¬ç”šè‡³æ›´ä¼˜ (96.1 vs 129.1)
> 3. Legacyçš„æ—¶é—´ä»£ä»·å¾ˆå° (å¹³å‡26ms,ä¼˜åŒ–å)
> 4. åˆ é™¤Legacyä¼šè®©ç³»ç»Ÿé²æ£’æ€§ä»100%é™è‡³76.5%,ä¸å¯æ¥å—
> 
> **åœ¨æ²¡æœ‰æ›´å¥½çš„DFS/A\*å®ç°ä¹‹å‰,Legacyæ˜¯ä¿è¯ç³»ç»Ÿç¨³å®šæ€§çš„å…³é”®å®‰å…¨ç½‘,ä¸åº”åˆ é™¤ã€‚**

---

**åˆ†æå®Œæˆ**: 2025-11-10  
**å»ºè®®ç­‰çº§**: ğŸ† **å¼ºçƒˆæ¨èä¿ç•™Legacy**  
**ä¾æ®**: test.txtè¿è¡Œæ•°æ® + é²æ£’æ€§åˆ†æ
